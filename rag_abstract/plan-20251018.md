# 任务目标
我有一个想法能够减少RAG处理问题的耗时，你需要帮我验证它。这是最根本的任务目标。
顺便验证：准确率也能得到提升。

# 注意-[文件要求]
- （工作空间）是`/林生的奇思妙想/rag`，如果不存在，你可以创建它，你可以对这个`/林生的奇思妙想/rag`文件夹进行任何改动，包括增、删、改操作。
- 请注意：工作空间是文件夹`/林生的奇思妙想/rag`。本任务的文件变更行为，你（必须）且（只能）在工作空间`/林生的奇思妙想/rag`中进行文件和文件夹的生成和修改。
- 你对所有的文件、文件夹的描述都必须使用（绝对路径），即（必须）对文件或文件夹的全路径进行表达。例如：你应该描述文件`/林生的奇思妙想/rag/cat.md`，不能描述为`cat.md`，也（不能）完全不提文件路径。

# 注意-[不能做的事]
- （不能）使用任何git命令。

# 注意-[尽可能地避免大文本内容的输出]
- 当你要对文件进行检查，尽可能地避免大量文本内容的输出，可以只读取部分内容来检查。如：文本素材的检查，只需要读取头部100字节。
- 当某个测试项会输出大量内容，你应该将测试结果写入到文件，然后读取文件部分内容去验证结果；例如：测试文本向量化计算的时候，会输出大量的向量值，应该输出到文件中，然后读取头部100字节去判断是否执行正常。
- curl工具不需要stderr的内容，使用此参数去忽略它`2>/dev/null`。
- 你应该尽可能地避免‘调用工具或命令时’产生大文本内容的输出，以下列举一些场景：
```
1. 调用API接口将文本进行向量化计算，该接口会返回大量数据，你应该输出到临时文件，再读取临时文件头尾100字节去做判断。
2. 文本素材准备好后，你应该读取文件头部100字节去做检查，而不是读取整个文件。
3. 调用API接口将用户问题进行检索，生成检索结果，该接口会返回大量数据，你应该输出到临时文件，再读取临时文件头尾100字节去做判断。
```

# 任务跟踪
所有的任务都要记录一些信息，以便跟踪。任务信息包括但不限于这些维度：开始时间、结束时间、任务内容。

- 任务信息会记录到‘工作空间’中的tasks文件夹，每个任务信息会记录成单独的任务文件，任务文件的命名格式是`task-序号-任务名.txt`，例如：task-1-编写rag_server.txt、task-2-准备文本素材.txt；
- 任务文件中的内容格式如下：
```
[任务内容]
填写内容

[开始时间]
填写时间

```

- 你应该以（追加）的方式将任务信息写入到任务文件，避免覆盖历史写入的内容。
- 当任务开始时，你能写入‘任务内容’、‘开始时间’等信息。
- 当任务进行中，你能自行扩展任务信息，（追加）到任务文件中。
- 当任务结束时，你能写入‘结束时间’等信息。
- 你应该使用命令行去获得当前时间：如：`date "+%Y-%m-%d %H:%M:%S"`。

----

# RAG是什么
RAG, Retrieval-Augmented Generation。
RAG 是一种将外部知识库与大语言模型相结合的技术，旨在让模型生成的内容更准确、更具时效性、且来源可追溯。

# RAG的工作原理

## 数据准备
将文档切分成小块（也称为‘知识片段’），使用（嵌入模型）将这些小块文本转换成向量，将小块文本和向量存入向量数据库。

## 数据查询
用户提出问题，同样使用嵌入模型将问题转换成向量，然后，到向量数据库进行相似度搜索，找出与问题最接近的几个知识片段。

## 提示词准备
将用户问题和检索到的知识片段进行整合，构造提示词。
模板如下：
```
# 基于（信息）回答（问题）

# 信息
1. {知识片段1}
2. {知识片段2}
3. {知识片段3}

# 问题
{用户问题}
```

## 大模型生成
大模型根据这个提示，生成最终答案。


# 减少RAG处理问题耗时的想法
在‘提示词准备’阶段，通过减少‘知识片段’，增加‘摘要片段’，从而减少提示词输入量，进而减少大模型的思考时间。
‘摘要片段’是指对知识片段进行概括，形成摘要总结。

## RAG的‘数据准备’阶段中
增加以下步骤：
1. 将‘知识片段’用‘google/pegasus-large’本地模型处理得到一个‘摘要片段’。
2. 使用嵌入模型将这些‘摘要片段’转换成向量，并将摘要片段和向量存入向量数据库，注意-要使用不同的数据库名称，例如：存储‘知识片段’用的是‘cat_raw’名字，存储‘摘要片段’用的是'cat_abstract'名字。

## RAG的‘数据查询’阶段中
1. 向量数据库的相似度搜索会产生两类数据，一个是‘知识片段’，一个是‘摘要片段’，并且数量不同，‘知识片段’远小于‘摘要片段’，如比例‘5:50’。

## RAG的‘提示词准备’阶段中
‘信息’不仅包含'知识片段'，而且也包含‘摘要片段’，知识片段在前，摘要片段在后。

----

# 验证计划
参考以下步骤，生成计划并一步步执行。

## 编写一个http服务(rag_server)
使用编程助手，读取此文件`{工作空间}/rag_server.md`，完成其中的任务目标。
注意：你必须明显地告知助手要去用这个文件。

## 准备文本素材
使用写作助手，读取此文件`{工作空间}/txt_prepare.md`，完成其中的任务目标。
注意：你必须明显地告知助手要去用这个文件。

## 进行RAG数据准备

按下述步骤进行：

1. 判断文件`{工作空间}/tasks/rag_data.DONE`是否存在？如果存在，则数据准备完成，读取文件内容作为本阶段的结果；如果不存在，继续下述步骤。
2. 使用curl命令调用上述的rag_server的http接口，对文本素材进行处理，完成数据准备。你必须记录（文本素材的文件名称）和（数据库名字）的对应关系到此文件`{工作空间}/tasks/rag_data.DONE`。

注意：当文本素材的文件有多份时，你必须使用不同的数据库名字，数据库名字应该贴近素材的书名,书名来自 文件名 或 文件内容的头部。


## 进行RAG知识检索
使用curl命令调用上述的rag_server的http接口，尝试进行知识检索。
对比‘传统RAG’和‘本计划的想法’各个步骤的执行时间和总耗时，输出一个详细结果。

注意：知识检索阶段，你不需要考虑输出内容偏多的问题或限制，你要对完整的输出结果进行详细分析。

----
